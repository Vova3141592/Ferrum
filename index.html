<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ferrum course</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">Виды ИТ-инфраструктур</div>
    <div>В этой главе я расскажу, как можно сэкономить, покупая меньше железа. Как можно заменить железо софтом (т. е. программами).</div>
    <div>Стандартный подход сделать ИТ-инфраструктуру в компании:
        <br>- купить кучу нормальных компьютеров;
        <br>- купить кучу серверов.
    </div>
    <div>Это т. н. "дивергентная инфраструктура". Она выглядит вот так:</div>
    <div class="img"><img src="img/2023-05-20 154720.png" alt="Дивергентная инфраструктура"></div>
    <div>Все элементы системы отделены друг от друга. Все элементы относительно самостоятельны. Классика. Такую инфраструктуру я видел на практике в ЦБДД, в Пермской станции скорой медицинской помощи и в центре гигиены и эпидемиологии в Пермском крае.</div>
    <div>Но можно сделать проще:
        <br>- взять самые слабые компьютеры, просто остатки какие-нибудь;
        <br>- поставить мощный сервер для вычислений;
        <br>- поставить сервер с кучей ЖД и SSD для хранения данных.
    </div> 
    <div>Это т. н. "конвергентная инфраструктура". Она выглядит вот так:</div>
    <div class="img"><img src="img/2023-05-20 155044.png" alt="Конвергентная инфраструктура"></div>
    <div>Все компьютеры максимально простые, потому что на них ничего не делается, они нужны только для того, чтобы подключиться к виртуальным рабочим местам.</div>
    <div>Есть один сервер для вычислений: там находится 1С без базы данных, почтовый сервер без базы данных, бездисковые виртуальные рабочие места, контроллер домена и веб-сервер без базы данных. В общем, все серверы-программы переехали на один сервер-компьютер.</div>
    <div>Есть сервер для данных. Здесь находятся всякие базы данных: для 1С, для веб-сервера, для почтового сервера и SSD для виртуальных рабочих мест.</div>
    <div>Все программы на сервере для вычислений нужно настроить так, чтобы они сохраняли и использовали данные с сервера для данных. В наше время все ОС являются сетевыми (то есть могут без проблем брать любые файлы из сети, как будто эти файлы находятся прямо на том компьютере, где эти ОС работают), поэтому это вполне возможно сделать. Например, можно создать сетевые папки, а потом указать в программах пути для сохранения файлов в эти папки. Или указать, что будет использоваться БД, расположенная по определённому IP-адресу с определённым портом. Не суть, как это делается, это я к тому, что это вполне возможно.</div>
    <div>В конвергентной инфраструктуре, которая представлена на картинке, используются т. н. виртуальные рабочие места. Это не обязательный элемент конвергентной инфраструктуры, но он позволяет сделать ещё больше централизации: чтобы всё стало ещё более сконцентрированным.</div>
    <div>Что такое виртуальные рабочие места? Это такая технология, что компьютеры нужны только для доступа на сервер. Когда ты включаешь компьютер, он загружает операционную систему не у себя, а ту, которая находится на сервере. И вычисления все происходят тоже на сервере. И данные хранятся на сервере. Сам компьютер нужен только для загрузки операционной системы, которая находится на сервере, и для вывода изображения на экран.</div>
    <div>Как такое сделать? Есть два способа:
        <br>- VDI (Virtual Desktop Infrastructure) - на сервер устанавливается брокер подключений, гипервизор и куча виртуальных машин;
        <br>- терминальный сервер - на сервере нужна просто многопользовательская операционная система (ОС), а компьютеры подключаются к этому серверу с помощью протокола удалённого рабочего стола.
    </div>
    <div>Что такое гипервизор? Это такая программа, которая позволяет запускать внутри компьютера другие компьютеры. Например, программа VirtualBox:</div>
    <div class="img"><img src="img/vb.png" alt="Программа-гипервизор VirtualBox"></div>
    <div>С помощью гипервизора можно запускать разные операционные системы внутри одной операционной системы. Обычно они для этого и используются.</div>
    <div>Вот эти "компьютеры в компьютере" - это виртуальная машина.</div>
    <div>Чтобы виртуальные машины работали, происходит имитация (все это называют эмуляцией, но мне кажется, что слово "имитация" понятнее звучит). Т. е. одна ОС имитирует работу другой ОС.</div>
    <div>Есть разные варианты имитации:</div>
    <div>1. Полная, когда имитируются всё: таблица страниц памяти, все операции процессора и так далее. Такой вариант самый универсальный. С помощью него из любой операционной системы можно запустить любую другую операционную систему.</div>
    <div>2. Т. н. "паравиртуализация" - это неполный вариант виртуализации, где низкоуровневые ресурсы напрямую не имитируются. Здесь с помощью API (API (Application Programming Interface) - это, по простому говоря, кнопки, с помощью которых одна программа может управлять другой. На самом деле, кнопок нет, вместо них - команды. Какая-то программа может посылать другой программе команды, и та другая программа будет как-то на эти команды отвечать, что-то делать, в зависимости от функционала команд. В общем, у одной программы есть интерфейс, другие программы могут этим интерфейсом пользоваться, чтобы управлять этой программой. Пример API - VK API, с помощью этого API программы могут управлять социальной сетью VK) гостевые ОС используют функции хостовой ОС (гостевые ОС - это "компьютер в компьютере". Хостовая ОС - это ОС самого компьютера, как бы главная ОС, в которой "сидят" другие.), не обращаясь напрямую к низкоуровневым ресурсам. Из-за этого лишний раз эмулировать что-то не нужно, не нужно как бы изобретать велосипед, поэтому скорость повышается. Но в таком случае гостевые ОС обязательно должны быть с открытым исходным кодом, чтобы их можно было модифицировать для паравиртуализации. Так что это менее универсальный способ. И гостевую ОС нужно переделывать (т. е. нужно будет где-то скачать специальный вариант ОС, чтобы он работал с паравиртуализацией). Пример гипервизора с паравиртуализацией - Xen.</div>
    <div>3. Контейнеризация - это способ виртуализации, где гостевые ОС используют ядро хостовой ОС. Это самый быстрый способ, потому что по факту ядро ОС одно, разное только то, что сверху. Пример такого гипервизора - OpenVZ. Падение производительности гостевых ОС с таким гипервизором по сравнению с обычным вариантом установки всего 1-3%. Но у гипервизора OpenVZ есть куча недостатков: хостовой ОС должен быть Linux, но не любой, а с определённой версией ядра. Хостовыми ОС тоже может быть только Linux с той же версией ядра. Есть ещё популярная программа для контейнеризации Docker, у неё такая особенность, что она пытается имитировать работу не целой ОС, а отдельного приложения, но так, что это приложения как будто находится в определённой ОС. То есть это ещё более облегчённый вариант виртуализации. Как это можно использовать? Например, если кто-нибудь сделал программу для Linux, её можно засунуть в контейнер и запустить в Windows. Она будет работать на ядре Linux, но внутри Windows. Правда, в таком случае скорость получится небольшой, потому что ядро Linux будет работает поверх Windows. Чтобы скорость была большой, контейнер Docker нужно запускать в такой ОС, которая использует то же ядро, что и программа, которую вы засунули в контейнер. Т. е. если программа в контейнере работает на Linux, то и хостовая ОС тоже должна быть на Linux.</div>
    <div>VDI состоит из клиентов, брокера подключений, гипервизора и виртуальных машин:</div>
    <div class="img"><img src="img/vdi.png" alt="VDI"></div>
    <div>На картинке нет коммутатора и маршрутизатора, я их для простоты убрал.</div>
    <div>Клиенты - это обычные компьютеры. На них вычисления не происходят, они нужны для подключения к виртуальным машинам (ВМ) на сервере.</div>
    <div>Брокер соединений - это такая штука, которая нужна для балансировки нагрузки. Она определяет, к какой виртуальной машине подключить того или иного клиента.</div>
    <div>Есть сервер-компьютер.</div>
    <div>На сервере ещё стоит гипервизор какой-нибудь.</div>
    <div>Есть виртуальные машины (ВМ), к которым подключаются клиенты.</div>
    <div>VDI обычно делается с помощью специальной программы, в которой есть все эти функции. Вот самые лучшие варианты:</div>
    <div>1. Есть целая куча программ от VMWare, комбинируя которые, можно получить VDI (но это платные программы). Это должен быть самый продвинутый вариант. Но сложный и дорогой.</div>
    <div>2. Можно сделать VDI с помощью специальной роли "VDI" в Windows Server (Windows Server - платная ОС, но роль "VDI" бесплатная). Получается наполовину платно и делается легко.</div>
    <div>3. Можно использовать OpenUDS - это программа, с помощью которой делается VDI бесплатно. Работает на Linux. Наверное, делается не очень легко, ведь это Linux.</div>
    <div>Терминальный сервер - это ещё один способ сделать так, чтобы использовать слабые компьютеры просто как посредников, а все вычисления производить на сервере и данные хранить тоже на каком-нибудь сервере.</div>
    <div>Терминальный сервер отличается от VDI тем, что здесь нет отдельных ОС для каждого пользователя. Вместо этого здесь одна многопользовательская ОС, к которой пользователи подключаются с помощью какого-нибудь протокола удалённого рабочего стола.</div>
    <div>Наверное, все знают, что в Windows может быть несколько пользователей:</div>
    <div class="img"><img src="img/dz.png" alt="Диспетчер задач, один пользователь"></div>
    <div>На картинке пользователь один, но их может быть много.</div>
    <div>Именно так это и работает. Можно создать на сервере пользователей, раздать им права, а потом эти пользователи с других компьютеров с помощью протокола удалённого рабочего стола (например, RDP в Windows или XRDP в Linux) подключатся к этому серверу и будут на нём работать. </div>
    <div>Терминальный сервер можно сделать 3 способами:</div>
    <div>1. LTSP - это набор программ для Linux, который позволяет превратить ОС Linux в полноценный терминальный сервер.</div>
    <div>2. Просто один протокол удалённого рабочего стола xrdp + многопользовательская ОС Linux, например Xubuntu. Это очень простой способ сделать бесплатный Терминальный сервер. В нашем колледже именно таким образом сделан доступ к программе 1С. Не знаю, как сейчас, но в 2022 году было так.</div>
    <div>3. RDC - это служба в Windows Server, которая делает полноценный терминальный сервер. Простой способ, только Windows Server платная.</div>
    <div>В отличие от VDI, в терминальном сервере у пользователей нет отдельных ОС. Поэтому, если у кого-нибудь из-за ошибки программы зависнет вся ОС, то зависнет всё и у других пользователей. Придётся весь сервер перезагружать. Но такой способ намного оптимизированнее, потому что ОС одна на всех. Меньше оперативной памяти нужно, меньше постоянной памяти, меньше времени процессорного нужно.</div>
    <div>Что лучше - VDI или терминальный сервер? VDI технически лучше, потому что у всех пользователей своя отдельная ОС, которую можно переделать под себя, можно использовать права администратора, при зависании одной ОС все остальные продолжают работать, все пользователи изолированы друг от друга, поэтому в случае заражения вирус не сможет распространиться за пределы заражённой ВМ (если в сети исходящие соединения от этой ВМ запрещены), можно делать удобно резервное копирование (снимки состояния ВМ (снимки состояния - это как будто ты берёшь ВМ, копируешь её, замораживаешь и ложишь в морозилку лежать, пока она тебе снова не понадобится. Потом, допустим, ВМ сломалась. Либо сервер сгорел, либо ОС в виртуальной машине по какой-то причине поломалась, что нужно переустанавливать. Тогда берёшь из морозилки снимок состояния, загружаешь его куда-то в гипервизор (где-то в программе для этого должно быть специальное место, куда можно загрузить), и всё работает, как будто ты просто отмотал время назад, в то место, откуда ты делал снимок. В общем, как будто точка восстановления. Всё просто.).</div>
    <div>У терминального сервера нет всех этих преимуществ. Вместо этого он просто намного лучше оптимизирован. Ещё терминальный сервер легче настроить.</div>
    <div>Таким образом, если у вас куча денег или слишком мощный сервер, лучше сделать VDI. Если ваша цель сэкономить и сделать быстро - придётся использовать терминальный сервер.</div>
    <div>Кроме дивергентной и конвергентной инфраструктуры, существует и гиперконвергентная инфраструктура. Это то же самое, что и конвергентная, но с той лишь разницей, что нет отдельного сервера для вычислений и для данных, потому что всё находится на одном сервере. Это выглядит вот так:</div>
    <div class="img"><img src="img/hc.png" alt="Гиперконвергентная инфраструктура"></div>
    <div>В плане железа конвергентная инфраструктура проще, чем дивергентная. Но при этом в плане софта сложнее, потому что нужно виртуализацию делать.</div>
    <div>Гиперконвергентная инфраструктура же проще конвергентной и в плане железа, и в плане софта. Хотя бы потому, что не нужно уже настраивать программы так, чтобы они хранили данные на отдельном сервере.</div>
    <div>Таким образом, гиперконвергентная инфраструктура - это ещё одно упрощение, это упрощение конвергентной инфраструктуры. Нет отдельного сервера для данных.</div>
    <div>А лучше ли так или хуже?</div>
    <div>Все говорят, что лучше хранить данные отдельно, но никто не говорит почему. Я даже загуглил. Не нашёл информацию, почему так лучше. Но искал не очень долго. Так что я не знаю, что лучше. Не буду ничего утверждать. Хотя скажу, что мне кажется более привлекательным тот вариант, где все файлы хранятся на одном сервере. Потому что так проще. У меня у самого на всех компьютерах все файлы хранятся в одном разделе на всём диске (раздел на диске - это как бы логическое разделение диска. Вот у тебя есть один HDD, а ты хочешь, чтобы у тебя было два HDD. Ты можешь просто сделать два раздела на одном HDD, это будет то же самое, что и два HDD. Можно поставить на разные разделы разные ОС, разные файловые системы и т. д.). У меня дома есть сервер, на котором и данные, и программы сразу работают. Там тоже один раздел на всём диске.</div>
    <div>Обычно говорят, что делать всё на одном сервере опасно, потому что он может сломаться, и тогда пропадёт вообще всё. Но для этого можно просто поставить куда-нибудь очень простецкий компьютер с кучей HDD просто для того, чтобы на него копировать все файлы с сервера, делать бэкапы. Когда сервер сломается, просто меняешь что сломалось на новое и загружаешь бэкап. Всё продолжает работать. Всё просто.</div>
    <div>Гиперконвергентная инфраструктура - это не самая простая инфраструктура. Можно упростить ещё сильнее: вообще избавиться от сервера. Это т. н. облачная инфраструктура - когда мы используем не свои серверы, а чужие. Это выглядит таким образом:</div>
    <div class="img"><img src="img/cc.png" alt="Облачная инфраструктура"></div>
    <div>Расскажу про 4 вида облаков:
        <br>1) IaaS - Infrastructure as a Service;
        <br>2) PaaS - Platform as a Service;
        <br>3) SaaS - Software as a Service;
        <br>4) DaaS - Desktop as a Service.
    </div>
    <div>Хотя существует и куча других облаков "as a Service":
        <br>- Database as a Service (разновидность PaaS) - аренда базы данных;
        <br>- Middleware as a Service (разновидность PaaS) - аренда вспомогательного ПО;
        <br>- Contact-Center-as-a-Service - аренда техподдержки?
        <br>- Security as a service - аренда безопасности какая-то.
    </div>
    <div>Но я расскажу только про те 4 вида облаков, потому что они самые полезные.</div>
    <div>На картинке сравнение первых 3 видов:</div>
    <div class="img"><img src="ccc.png" alt="Сравнение облачных услуг"></div>
    <div>IaaS (Infrastructure as a Service) - вы арендуете виртуальные машины, устанавливаете какие захотите на них ОС, потом программы, а потом что-нибудь там ещё делаете, что захотите. Можно арендовать несколько виртуальных машин, а потом в личном кабинете хостера создать между ними виртуальную сеть (по логике должно быть можно, но я не проверял). Пример - любой VPS/VDS-хостинг. Например, от хостинг Selectel (первое, что на ум приходит).</div>
    <div>PaaS (Platform as a Service) - проще предыдущего. Здесь уже не нужно делать всё самому, здесь вы арендуете какие-то услуги. Здесь вам не дадут устанавливать свои программы, свои БД, свою ОС. Можно только выбрать из того, что предлагают. Например, вы можете выбрать какую-нибудь БД, веб-сервер, язык программирования для Бэкенда, а потом просто закинуть файлы своего сайта в папку в этом облаке. И у вас будет сайт работать. Получится хостинг.</div>
    <div>Но PaaS - это не только хостинг, это что угодно. Бывает целая куча самых разных услуг. Можете на Yandex Cloud посмотреть, там есть что выбрать.</div>
    <div>SaaS - (Software as a Service) - здесь ещё проще. Вам вообще ничего выбрать не дадут, будете пользоваться тем, что есть. И здесь уже ничего создавать или программировать не нужно будет, потому что вы арендуете как бы уже программы. Например, сюда входит Яндекс почта, Яндекс диск, Яндекс таблицы, Яндекс документы и так далее. Яндекс 360 сюда входит. Всё то же самое, но от Google сюда входит. Просто всякие сервисы сюда входят, которыми нужно уже именно пользоваться, а не что-то разрабатывать.</div>
    <div>DaaS - Desktop as a Service - это вы арендуете рабочие места в облаке. Как VDI или терминальный сервер. Вот волшебство ведь! Мы привыкли, когда всякие сервисы в облаке, но когда весь твой компьютер полностью в облаке и доступен из любой точки мира и с любого компьютера-посредника, это уже намного необычнее! Например, Selectel такое предлагает.</div>
    <div>
    Так вот, как можно облака использовать себе в пользу? Очень легко использовать бесплатные SaaS: Яндекс диск, Яндекс почта, Яндекс документы и всё остальное. И уже становятся не нужны никакие почтовые серверы отдельные, никакие файловые серверы, никакие платные Word, Excel, PowerPoint и так далее. Очень простой способ сэкономить!</div>
    <div>Потом, если в компании нужны мощные компьютеры, их можно просто арендовать в виде DaaS.</div>
    <div>Если компании нужен сайт, придётся арендовать хостинг (если хочешь как проще. Если хочешь по-сложному, придётся свой веб-сервер делать. Но это уже дивергентная инфраструктура, а мы пока говорим как можно всё упростить). По сути хостинг - это PaaS.</div>
    <div>Кстати, если сайт статичный (то есть у него просто нет бэкенда: всё происходит на стороне пользователя), то можно использовать бесплатный хостинг статичных сайтов GitHub Pages. Для большинства государственных компаний (да не только для них) динамичный сайт и не нужен, хватит статичного. Поэтому можно обойтись даже без аренды хостинга!</div>
    <div>И всё. С помощью комбинации бесплатных SaaS и бесплатного хостинга GitHub Pages можно закрыть какие-нибудь простые требования бизнеса.</div>
    <div>Если в организации нужны мощные компьютеры и сайт с бэкендом, то добавится DaaS и хостинг (PaaS).</div>
    <div>Вот так вам помогут облака!</div>
    <div>Можно ли упростить всё ещё сильнее? Можно! Нужно просто отправить сотрудников в облака, ой, то есть на удалёнку. И тогда… И тогда схема вашей сети станет выглядеть так:</div>
    <div>Картинки нет, потому что у вас больше не будет сети!</div>
    <div>Просто используешь разные виды облаков и сотрудников на удалёнке. Тогда вообще никакой физической инфраструктуры уже не будет! Мы настолько всё упростили, что теперь нам и вовсе никакое железо не нужно! И стоит это всё бесплатно, если пользоваться бесплатными облаками!</div>
    <div>Хочу ещё кое-что сказать. На самом деле, понятие дивергенции и конвергенции относится не только к инфраструктуре информационной системы. Это в принципе способ делать всё отдельно или всё вместе.</div>
    <div>Например, если тебе нужен компьютер, то дивергентный подход - собрать настольный ПК, с системным блоком, как бы коробку такую. Там же будут разные запчасти, в этом заключается дивергенция. Конвергентный подход - купить ноутбук. И что лучше? Ноутбук вообще получится дешевле, если учесть все компоненты. Ноутбук ещё проще. Ноутбук - это быстрее.</div>
    <div>Но с обычным компьютером можно будет заменять отдельные запчасти, если захочешь сделать апргейд. Можно будет отдельные запчасти заменять, если какая-то из них сломается.</div>
    <div>Но если вы обратите внимание, обычные люди уже настольными ПК не пользуются. У них либо смартфон, либо ноутбук. Ещё раньше существовал северный мост на материнских платах, а теперь он встроен в процессор. Процессоры Apple теперь делаются со встроенной в них оперативной памятью. Раньше не существовало встроенных видеокарт, а теперь проще сделать офисный компьютер именно со встроенной. Так что мне кажется, что мир движется в сторону конвергенции. За конвергенцией будущее.</div>
    <div>Конвергентный и дивергентный подход есть и в ОС. Например, в Linux есть такой принцип, что каждая программа должна хорошо делать только что-то одно. Поэтому, говоря о Linux, вместо слова "программа" мы чаще слышим слово "утилита". Утилита - это такая программа, которая может делать только что-то одно. Таким образом удобно сделать систему под себя. Например, в Linux есть межсетевой экран iptables, DHCP-сервер ISC-DHCP, DNS-сервер Bind9, "обновитель ресурсных записей для DDNS" ddclient (не знаю, как правильно назвать эту программу, поэтому будет "обновитель"), веб-сервер Apache и так далее. Все программы делают только что-то одно.</div>
    <div>В Windows же используется скорее конвергентный подход. Здесь программы как бы универсальные все.</div>
    <div>И что вы думаете? Linux, конечно, более настраиваемый. Как и системный блок, как и дивергентная инфраструктура. Из-за этого он технически лучше, но и сложнее. Поэтому им пользуется 2% всех людей. Из-за конвергентного подхода Windows популярнее.</div>
    <div>Кстати, а все ОС от Apple ещё проще, чем Windows. Там вообще ничего настраивать нельзя. Может быть, из-за этого капитализация у Apple больше, чем у Microsoft? И вообще Apple - это самая богатая компания в мире, не считая Saudi Aramco.</div>
    <div>Магазины существуют дивергентные и конвергентные. Можно пойти в магазин спортивной одежды, в продуктовый магазин, в овощной, в мясной и так далее. А можно просто купить всё на Wildberries или на Ozon. Обратите внимание, что раньше люди ходили в овощной, в мясной, в пекарню по отдельности. А теперь мы чаще ходим просто в один большой магазин и покупаем всё сразу там. Постепенно мы переходим просто на маркетплейсы. То есть тоже конвергентный подход постепенно становится более популярным.</div>
    <div>Как видите, в общем всё идёт к упрощению. Постепенно всё переходит от дивергентного подхода к конвергентному. Всё упрощается и объединяется. Поэтому я за такой подход, за современный. Хотя технически конвергентный подохд чаще оказывается хуже (хотя в случае с северным мостом в процессоре и оперативной памятью в процессоре, мне кажется, стало только лучше, просто ремонтопригодность уменьшилась, зато пропускная способность увеличилась), зато он проще и экономит время. И да, выходит, даже не всегда хуже.</div>
    <div>Так вот, к чему вся эта глава? Я хотел показать, что мы вполне можем полностью избавиться из железа в инфраструктуре. Мы можем меньше возиться с железом, если будем пользоваться ноутбуками или смартфонами вместо настольных ПК. Мы можем меньше ходить по магазинам, если будем пользоваться маркетплейсами. Мы можем сэкономить время, если будем пользоваться удобными ОС вместо Linux (а если и пользоваться Linux, то Ubuntu, потому что это самый простой Linux).</div>
</body>
</html>